name: Create Release on 'Cut'

on:
  push:
    branches:
      - main  # IMPORTANT: Change this to your default branch (e.g., master)

# Grant permissions for the GITHUB_TOKEN to create tags and releases
permissions:
  contents: write

jobs:
  create-release:
    # This job will only run if the head commit message contains "Cut "
    if: contains(github.event.head_commit.message, 'Cut ')
    runs-on: ubuntu-latest
    steps:
      # Step 1: Extract the version string from the commit message
      # It assumes the message is "Cut [version]", e.g., "Cut 1.0.1+8"
      # It uses awk to get the second "word", which is "1.0.1+8"
      - name: Extract version from commit
        id: extract_version
        run: |
          VERSION=$(echo "${{ github.event.head_commit.message }}" | awk '{print $2}')
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      # Step 2: Create the GitHub Release
      # This action automatically creates the tag if it doesn't exist,
      # pointing it to the commit that triggered the workflow.
      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          # This token is provided by GitHub Actions
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # The tag to create, from the output of the previous step
          tag_name: ${{ steps.extract_version.outputs.version }}
          
          # The title of the release (e.g., "v1.0.1+8")
          release_name: v${{ steps.extract_version.outputs.version }}
          
          # This ensures the tag is created on the exact commit that triggered the workflow
          commitish: ${{ github.sha }}
          
          # Use the full commit message as the body of the release
          body: ${{ github.event.head_commit.message }}
          
          # Mark as a full release (not a draft or pre-release)
          draft: false
          prerelease: false